# ğŸŒ¿ Gardener â€” è‡ªåŠ¨ä»£ç å¤æ‚åº¦ä¿®å‰ªè®¡åˆ’

> **Status**: M0 + M2 å·²å®ç°ï¼Œå¾…å®æˆ˜éªŒè¯
> **Last updated**: 2026-02-16

## æ ¸å¿ƒæ€æƒ³

Gardener æ˜¯ nanobot-auto çš„ä¸€ä¸ª **skill**ï¼Œå®ƒå¯¹ä»»æ„ç›®æ ‡ä»“åº“æ‰§è¡Œç¡®å®šæ€§çš„ Sense â†’ Effect â†’ Gate é—­ç¯ï¼š

```
Gardener skill
  â”œâ”€â”€ è¾“å…¥: repo_pathï¼ˆä»»æ„ä»“åº“ï¼‰
  â”œâ”€â”€ Sense: radon cc â†’ æœ€é«˜å¤æ‚åº¦å‡½æ•°ï¼ˆç¡®å®šæ€§ï¼Œä¸è®© LLM é€‰ï¼‰
  â”œâ”€â”€ Effect: LLM é‡æ„ï¼ˆæå–å­å‡½æ•°ã€ç®€åŒ–åˆ†æ”¯ï¼‰
  â”œâ”€â”€ Gate: å››é‡é—¨æ§ â†’ commit or revert ALL
  â””â”€â”€ Memory: {repo_path}/journal.mdï¼ˆper-repoï¼Œpipe-delimitedï¼‰
```

- å¯¹ nanobot-auto è‡ªèº«ç”¨ = **è‡ªæ¼”åŒ–å®éªŒ**
- å¯¹å…¶ä»–é¡¹ç›®ç”¨ = **é€šç”¨ä»£ç è´¨é‡å·¥å…·**

## ç›®æ ‡å‡½æ•°ï¼šç®€åŒ–çš„ H(t)

åªå…³æ³¨ä¸¤ä¸ª**ç¡®å®šæ€§æŒ‡æ ‡**ï¼ˆä¸éœ€è¦ LLM åˆ¤æ–­ï¼Œç”¨ Python è„šæœ¬ç®—ï¼‰ï¼š

| æŒ‡æ ‡ | å·¥å…· | ç›®æ ‡ |
|------|------|------|
| åœˆå¤æ‚åº¦ (Cyclomatic Complexity) | `radon cc` | é™ä½å¹³å‡å¤æ‚åº¦ |
| æµ‹è¯•è¦†ç›–ç‡ (Coverage) | `pytest-cov` | å•è°ƒä¸å‡ |

> **æ³¨æ„**ï¼šradon è®¡ç®—çš„æ˜¯ McCabe åœˆå¤æ‚åº¦ï¼Œä¸æ˜¯ SonarSource çš„è®¤çŸ¥å¤æ‚åº¦ã€‚ä¸¤è€…æ’åºå¯èƒ½ä¸åŒï¼Œä½†å¯¹æœ¬ç ”ç©¶ç›®çš„è€Œè¨€åœˆå¤æ‚åº¦å·²è¶³å¤Ÿã€‚

---

## é‡Œç¨‹ç¢‘

### ğŸš© M0: æœ€å°é—­ç¯ (The Dumb Looper) âœ…

**ç›®æ ‡**ï¼šå»ºç«‹ä¸€ä¸ª"ä¸ä¼šæ”¹åä»£ç "çš„æœºå™¨äººã€‚æ²¡æœ‰è®°å¿†ï¼Œä¸çŸ¥é“æ˜¨å¤©å¹²äº†ä»€ä¹ˆï¼Œä½†èƒ½å®‰å…¨åœ°é™ä½å¤æ‚åº¦ã€‚

**æ ¸å¿ƒåŠ¨ä½œ**ï¼š

1. **ç¡®å®šæ€§æ„ŸçŸ¥ (Sense)**
   - `scanner.py` ä½¿ç”¨ `radon cc` æ‰«æå…¨é¡¹ç›®
   - ç¡¬è§„åˆ™ï¼šè¾“å‡ºå¤æ‚åº¦æœ€é«˜çš„å‰ 3 ä¸ªå‡½æ•°ã€‚ä¸è®© LLM å†³å®šä¿®ä»€ä¹ˆï¼Œç”¨æ•°å­¦å†³å®š

2. **æ‰§è¡Œé‡æ„ (Effect)**
   - Agent è¯»å–**æ•´ä¸ªæºæ–‡ä»¶**ï¼Œé‡æ„ç›®æ ‡å‡½æ•°ï¼Œè¾“å‡º**æ•´ä¸ªä¿®æ”¹åçš„æ–‡ä»¶**ç›´æ¥è¦†ç›–
   - ä¸¥ç¦ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ã€ä¸¥ç¦ç ´åç°æœ‰æµ‹è¯•

3. **å››é‡é—¨æ§ (Gate)** â€” TEP ç»“æ™¶åçš„é˜²çˆ†ç‰ˆæœ¬
   - Gate 0: `git diff --name-only` æ£€æŸ¥ç¦åŒºæ–‡ä»¶ï¼ˆtest_*, conftest.py, è‡ªèº«è„šæœ¬, CONSTITUTION.md, .github/ï¼‰
   - Gate 1: `python3 -m py_compile` è¯­æ³•æ£€æŸ¥ï¼ˆå¿«é€Ÿæ‹¦æˆªæ­»å¾ªç¯/è¯­æ³•é”™è¯¯ï¼‰
   - Gate 2: `pytest --timeout=30` æµ‹è¯•é€šè¿‡
   - Gate 3: `radon cc` å¤æ‚åº¦å¿…é¡»ä¸¥æ ¼é™ä½
   - ä»»ä½•ä¸€é¡¹å¤±è´¥ â†’ `git checkout . && git clean -fd`ï¼ˆå…¨é‡å›æ»šï¼Œä¸æ˜¯å•æ–‡ä»¶ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- [x] `nanobot/skills/gardener/SKILL.md` â€” Agent è¡Œä¸ºæŒ‡ä»¤
- [x] `nanobot/skills/gardener/scripts/scanner.py` â€” ç¡®å®šæ€§æ‰«æå™¨
- [x] `nanobot/skills/gardener/scripts/gate.py` â€” å››é‡é—¨æ§
- [x] `nanobot/skills/gardener/scripts/journal.py` â€” è®°å¿†è¯»å†™

---

### ğŸš© M1: å¼•å…¥è®°å¿† (The Journaling Gardener) âœ…

**ç›®æ ‡**ï¼šè§£å†³"æ­»ç£•"é—®é¢˜ã€‚å¦‚æœæ˜¨å¤©ä¿® A å‡½æ•°å¤±è´¥äº†ï¼Œä»Šå¤©ä¸è¦å†è¯• Aï¼Œå»ä¿® Bã€‚

**æ ¸å¿ƒåŠ¨ä½œ**ï¼š

1. **journal.md** â€” ä¸¥æ ¼ pipe-delimited æ ¼å¼ï¼ˆæœºå™¨ç”¨ `split('|')` è§£æï¼‰ï¼š
   ```
   [2026-02-16] | target: nanobot/agent/tools/base.py::Tool._validate | status: Fail | cc: 27->27 | reason: æµ‹è¯•å¤±è´¥
   ```

2. **è¯»å–è®°å¿†**ï¼šscanner.py é€‰å‡ºæœ€è‡­å‡½æ•°åæŸ¥ journal.mdï¼Œæœ€è¿‘ 3 å¤©å†…æœ‰ Fail â†’ è·³è¿‡

3. **å†™å…¥è®°å¿†**ï¼šæ— è®º Gate æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå¼ºåˆ¶è¿½åŠ è®°å½•

> **è®¾è®¡å†³ç­–ï¼ˆTEP ç»“æ™¶ï¼‰**ï¼šjournal æ ¼å¼å¿…é¡»ä¸¥æ ¼æœºå™¨å‹å¥½ã€‚ä¸è¦è®© LLM è‡ªç”±å‘æŒ¥å†™ markdownï¼Œç„¶åç”¨æ­£åˆ™è§£æâ€”â€”é‚£æ˜¯ç¾éš¾çš„å¼€å§‹ã€‚

**äº¤ä»˜ç‰©**ï¼š
- [x] scanner.py é›†æˆ journal é¿è®©é€»è¾‘
- [x] journal.py æ”¯æŒ `--old-cc` / `--new-cc` å‚æ•°

---

### ğŸš© M2: åŸ‹ä¸‹æ•°æ®æ¢é’ˆ (The Data Collector) âœ…

**ç›®æ ‡**ï¼šå®æ–½æ•°æ®é‡‡é›†ã€‚ç°åœ¨ä¸åˆ†æï¼Œåªé‡‡é›†ã€‚

**æ¥æº**ï¼šTEP_PROCESS_MINING.md Phase 0 ç­–ç•¥

**æ ¸å¿ƒåŠ¨ä½œ**ï¼š

1. **æ‹¦æˆªç‚¹**ï¼š`ToolRegistry.execute()` â€” æ‰€æœ‰å·¥å…·è°ƒç”¨çš„å”¯ä¸€å…¥å£
2. **è®°å½•å™¨**ï¼š`nanobot/agent/tracer.py` â€” XES-compatible JSONL

**XES æ ‡å‡†å­—æ®µ**ï¼š
```jsonl
{
  "case_id": "20260216_233909_cron",
  "concept:name": "read_file",
  "time:timestamp": "2026-02-16T15:41:38.609871+00:00",
  "lifecycle:transition": "complete",
  "org:resource": "agent",
  "outcome": "success",
  "duration_ms": 1
}
```

**æ¶æ„**ï¼š
```
Agent æ”¶åˆ°æ¶ˆæ¯
  â†’ tracer.set_case_id(...)
  â†’ LLM å†³å®šè°ƒç”¨å·¥å…·
    â†’ ToolRegistry.execute()
      â†’ ToolTracer.__enter__()     â† start äº‹ä»¶
      â†’ tool.execute(**params)     â† å®é™…æ‰§è¡Œ
      â†’ ToolTracer.__exit__()      â† complete äº‹ä»¶ï¼ˆå« duration_ms, outcomeï¼‰
  â†’ æ—¥å¿—è‡ªåŠ¨å­˜å…¥ ~/.nanobot/.logs/trace_{case_id}.jsonl
```

**é›¶ä¾µå…¥æ€§**ï¼šæ‰€æœ‰å·¥å…·å®ç°ï¼ˆfilesystem, shell, web, message, spawn, cronï¼‰æ— éœ€ä»»ä½•æ”¹åŠ¨ã€‚

**äº¤ä»˜ç‰©**ï¼š
- [x] `nanobot/agent/tracer.py` â€” XES äº‹ä»¶è®°å½•å™¨
- [x] `nanobot/agent/tools/registry.py` â€” execute() è‡ªåŠ¨è¿½è¸ª
- [x] `nanobot/agent/loop.py` â€” åˆå§‹åŒ– + case_id è®¾ç½®

---

### ğŸš© M3: é—­ç¯åˆ†æ (The Scientist) ğŸ“‹

**ç›®æ ‡**ï¼šå½“ M2 ç§¯ç´¯äº†çº¦ 50-100 ä¸ªå‘¨æœŸçš„æ—¥å¿—åï¼Œå¼•å…¥ PM4Py è¿›è¡Œç¦»çº¿åˆ†æã€‚

**æ—¶é—´**ï¼šå¾…å®šï¼ˆæ•°æ®ç§¯ç´¯æœŸåï¼‰

**æ ¸å¿ƒåŠ¨ä½œ**ï¼š

1. **æµç¨‹å‘ç° (Process Discovery)**
   - pm4py è¯»å– `.logs/`ï¼Œç”Ÿæˆ DFG
   - æ´å¯Ÿç¤ºä¾‹ï¼šAgent åœ¨ `edit_file` ä¹‹åç´§æ¥ `edit_file` çš„æ¦‚ç‡ â†’ åå¤ä¿®æ”¹ â†’ éœ€è¦ä¼˜åŒ– Prompt

2. **åˆè§„æ£€æŸ¥ (Conformance Checking)**
   - å®šä¹‰è§„åˆ™ï¼š`edit_file` ä¹‹åå¿…é¡»æœ‰ `run_pytest`
   - pm4py è‡ªåŠ¨æ‰¾å‡ºè¿è§„ Case ID â†’ éœ€è¦äººå·¥ä¿®è¡¥ Agent é€»è¾‘

---

## TEP é˜²çˆ†ç»“æ™¶æ€»ç»“

ä»¥ä¸‹æ”»å‡»å‘é‡å·²ç»é€šè¿‡ TEP åˆ†æå¹¶å†™å…¥é˜²å¾¡ä»£ç ï¼š

| æ”»å‡» | é˜²å¾¡ | å®ç° |
|------|------|------|
| LLM æ”¹æµ‹è¯•æ–‡ä»¶éª—é—¨æ§ | `FORBIDDEN_PATTERNS` æ£€æŸ¥ git diff | gate.py Gate 0 |
| LLM æ”¹ scanner/gate è‡ªèº« | åŒä¸Šï¼Œå…¨åœ¨ç¦åŒºåˆ—è¡¨ | gate.py Gate 0 |
| æ­»å¾ªç¯/è¯­æ³•é”™è¯¯å¡æ­» pytest | py_compile å‰ç½® + --timeout=30 | gate.py Gate 1+2 |
| ä»£ç ç¼åˆç¾éš¾ | SKILL.md è¦æ±‚æ•´æ–‡ä»¶è¦†ç›– | SKILL.md Step 2 |
| å¤±è´¥ååª revert ä¸€ä¸ªæ–‡ä»¶ | git checkout . + git clean -fd | gate.py revert_all() |
| journal è§£æè„†å¼± | ä¸¥æ ¼ pipe-delimited | journal.py + scanner.py |

## éªŒè¯æ¡ä»¶

| é‡Œç¨‹ç¢‘ | éªŒè¯æ¡ä»¶ |
|--------|---------|
| M0 | è¿è¡Œä¸€æ¬¡ï¼Œå¹³å‡å¤æ‚åº¦é™ä½ or ä»€ä¹ˆéƒ½æ²¡æ”¹ï¼ˆæ— å®³ï¼‰ |
| M1 | è¿ç»­è¿è¡Œ 7 å¤©ä¸æ­»ç£•åŒä¸€ä¸ªå‡½æ•° |
| M2 | `~/.nanobot/.logs/` é‡Œæœ‰ JSONL æ–‡ä»¶ï¼Œå­—æ®µç¬¦åˆ XES |
| M3 | pm4py èƒ½è¯»å–æ—¥å¿—å¹¶ç”Ÿæˆ DFG |
